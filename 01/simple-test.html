<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç®€åŒ–æµ‹è¯• - Cesium ä¸‰ç»´ç®¡çº¿ç³»ç»Ÿ</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: #000;
        color: white;
      }
      #app {
        display: flex;
        height: 100vh;
      }
      .sidebar {
        width: 300px;
        background: #1a1a1a;
        padding: 20px;
        border-right: 1px solid #333;
      }
      .main {
        flex: 1;
        position: relative;
      }
      #cesiumContainer {
        width: 100%;
        height: 100%;
      }
      .status {
        position: absolute;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.8);
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .error {
        color: #ff4757;
      }
      .success {
        color: #00d4aa;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div class="sidebar">
        <h2>ğŸŒ Cesium ä¸‰ç»´ç®¡çº¿ç³»ç»Ÿ</h2>
        <div id="status">
          <div>çŠ¶æ€: <span id="status-text">åˆå§‹åŒ–ä¸­...</span></div>
          <div>Vue: <span id="vue-status">æ£€æŸ¥ä¸­...</span></div>
          <div>Cesium: <span id="cesium-status">æ£€æŸ¥ä¸­...</span></div>
        </div>
        <div style="margin-top: 20px">
          <button onclick="testCesium()">æµ‹è¯• Cesium</button>
          <button onclick="testVue()">æµ‹è¯• Vue</button>
        </div>
      </div>
      <div class="main">
        <div id="cesiumContainer"></div>
        <div class="status" id="coordinates">
          <div>ç»åº¦: <span id="lon">116.391</span>Â°</div>
          <div>çº¬åº¦: <span id="lat">39.907</span>Â°</div>
          <div>é«˜ç¨‹: <span id="height">42</span> m</div>
        </div>
      </div>
    </div>

    <script>
      // çŠ¶æ€æ›´æ–°å‡½æ•°
      function updateStatus(elementId, text, isError = false) {
        const element = document.getElementById(elementId);
        element.textContent = text;
        element.className = isError ? "error" : "success";
      }

      // æµ‹è¯• Vue 3
      function testVue() {
        updateStatus("vue-status", "åŠ è½½ä¸­...", false);

        const script = document.createElement("script");
        script.type = "module";
        script.textContent = `
                import { createApp, reactive } from 'https://cdn.jsdelivr.net/npm/vue@3/dist/vue.esm-browser.js';
                
                const app = createApp({
                    setup() {
                        const state = reactive({
                            message: 'Vue 3 å·¥ä½œæ­£å¸¸!'
                        });
                        return { state };
                    }
                });
                
                app.mount('#app');
                window.vueTest = true;
            `;

        script.onload = () => {
          setTimeout(() => {
            if (window.vueTest) {
              updateStatus("vue-status", "âœ… å·¥ä½œæ­£å¸¸", false);
            } else {
              updateStatus("vue-status", "âŒ åŠ è½½å¤±è´¥", true);
            }
          }, 1000);
        };

        script.onerror = () => {
          updateStatus("vue-status", "âŒ åŠ è½½å¤±è´¥", true);
        };

        document.head.appendChild(script);
      }

      // æµ‹è¯• Cesium
      function testCesium() {
        updateStatus("cesium-status", "åŠ è½½ä¸­...", false);

        window.CESIUM_BASE_URL =
          "https://cdn.jsdelivr.net/npm/cesium@1.99/Build/Cesium/";
        const script = document.createElement("script");
        script.src = window.CESIUM_BASE_URL + "Cesium.js";

        script.onload = () => {
          try {
            if (typeof Cesium !== "undefined") {
              const viewer = new Cesium.Viewer("cesiumContainer", {
                geocoder: false,
                homeButton: false,
                sceneModePicker: false,
                baseLayerPicker: false,
                navigationHelpButton: false,
                animation: false,
                timeline: false,
                fullscreenButton: false,
                vrButton: false,
                infoBox: false,
              });

              // è®¾ç½®åˆå§‹è§†è§’
              viewer.camera.setView({
                destination: Cesium.Cartesian3.fromDegrees(
                  116.391,
                  39.907,
                  1000
                ),
                orientation: {
                  heading: Cesium.Math.toRadians(0.0),
                  pitch: Cesium.Math.toRadians(-45.0),
                  roll: 0.0,
                },
              });

              // æ·»åŠ ç¤ºä¾‹å®ä½“
              viewer.entities.add({
                position: Cesium.Cartesian3.fromDegrees(116.391, 39.907, 0),
                cylinder: {
                  length: 1000,
                  topRadius: 0.5,
                  bottomRadius: 0.5,
                  material: Cesium.Color.CYAN.withAlpha(0.8),
                },
              });

              updateStatus("cesium-status", "âœ… å·¥ä½œæ­£å¸¸", false);
              updateStatus("status-text", "ç³»ç»Ÿå°±ç»ª", false);

              // é¼ æ ‡ç§»åŠ¨æ›´æ–°åæ ‡
              viewer.cesiumWidget.screenSpaceEventHandler.setInputAction(
                (event) => {
                  const pickedPosition = viewer.camera.pickEllipsoid(
                    event.endPosition,
                    viewer.scene.globe.ellipsoid
                  );
                  if (pickedPosition) {
                    const cartographic =
                      Cesium.Cartographic.fromCartesian(pickedPosition);
                    const longitude = Cesium.Math.toDegrees(
                      cartographic.longitude
                    );
                    const latitude = Cesium.Math.toDegrees(
                      cartographic.latitude
                    );
                    const height = cartographic.height;

                    document.getElementById("lon").textContent =
                      longitude.toFixed(6);
                    document.getElementById("lat").textContent =
                      latitude.toFixed(6);
                    document.getElementById("height").textContent =
                      height.toFixed(2);
                  }
                },
                Cesium.ScreenSpaceEventType.MOUSE_MOVE
              );
            } else {
              updateStatus("cesium-status", "âŒ Cesium æœªå®šä¹‰", true);
            }
          } catch (error) {
            updateStatus(
              "cesium-status",
              "âŒ åˆå§‹åŒ–å¤±è´¥: " + error.message,
              true
            );
            console.error("Cesium é”™è¯¯:", error);
          }
        };

        script.onerror = () => {
          updateStatus("cesium-status", "âŒ è„šæœ¬åŠ è½½å¤±è´¥", true);
        };

        document.head.appendChild(script);
      }

      // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
      window.addEventListener("load", () => {
        testVue();
        setTimeout(() => testCesium(), 2000);
      });
    </script>
  </body>
</html>
